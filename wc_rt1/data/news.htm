<html>
  <head>
    <title>Configure News</title>
    <meta http-equiv = 'content-type' content = 'text/html; charset = utf-8' />
    <style>
       body,td{font-family:tahoma,arial,helvetica,sans-serif;}
       table.t td.h{background-color:#C9C9C0;font-size:12px;font-weight:bold;text-align:center;}
       table.t td  {background-color:#E2E2DB;font-size:12px;text-align:center;}
    </style>
  </head>
  
  <body onload='loadValues();'>
    <table cellspacing='0' cellpadding='2' border='0' class='t' width='30%'>
      	<tr>
      	  <td align='center' class='h' width='10%'><a href='time.htm'>Time</a></td>
      	  <td align='center' class='h' width='10%'><a href='wifi.htm'>WiFi</a></td>
      	  <td align='center' class='h' width='10%'><a href='clock.htm'>Clock</a></td>
      	  <td align='center' class='h' width='10%'><a href='disp.htm'>Display</a></td>
      	  <td align='center' class='h' width='10%'><a href='sens.htm'>Sensor</a></td>
      	  <td align='center' class='h' width='10%'><a href='alarm.htm'>Alarm</a></td>
  		  <td align='center' class='h' width='10%'><a href='thermo.htm'>Thermo</a></td>
	      <td align='center' class='h' width='10%'><a href='news.htm'>News</a></td>
       	  <td align='center' class='h' width='10%'><a href='/edit'>Edit</a></td>
      	  <td align='center' class='h' width='10%'><a href='/exit'>Restart</a></td>
      	</tr>
        <tr><td colspan='10' height='20' align='center'><input type='text' id='cur_time' style='text-align:center;' readonly /></td></tr>
      </table>

      <table cellspacing='0' cellpadding='2' border='0' class='t' width='30%'>

		<form class='w3-container' action='/savenews' method='get'><h2>News Configuration:</h2>
			<p><input name='displaynews' class='w3-check w3-margin-top' type='checkbox' %NEWSCHECKED%> Display News Headlines</p>
			<label>News API Key (get from <a href='https://newsapi.org/' target='_BLANK'>here</a>)</label>
			<input class='w3-input w3-border w3-margin-bottom' type='text' name='newsApiKey' value='%NEWSKEY%' maxlength='60'>
			<p>Select News Source <select class='w3-option w3-padding' name='newssource' id='newssource'></select></p>
			
			<script>
			var s='%NEWSSOURCE%';
			var tt;
			var xmlhttp=new XMLHttpRequest();
			
			xmlhttp.open('GET','https://raw.githubusercontent.com/Qrome/marquee-scroller/master/sources.json',!0);
			xmlhttp.onreadystatechange = 
				function()
				{
					if(xmlhttp.readyState==4)
					{
						if(xmlhttp.status==200)
						{
							var obj=JSON.parse(xmlhttp.responseText);
							obj.sources.forEach(t);
						}
					}
				}
			xmlhttp.send();
			
			function t(it)
			{
				if(it!=null)
				{
					if(s==it.id)
					{
						se=' selected';
					}
					else
					{
						se='';
					}
					tt+='<option'+se+'>'+it.id+'</option>';
					document.getElementById('newssource').innerHTML=tt;
				}
			}
			
			function loadValues()
			{
				var xh = new XMLHttpRequest();
				xh.onreadystatechange =  function()
				{
				  if (xh.readyState == 4 && xh.status == 200) 
					{
					  var res = JSON.parse(xh.responseText);
					  document.getElementById('tzone').value = res.tzon;
					}
				  }
				 xh.open("GET", "/jclock", true);
				 xh.send(null);
			  }
		  
			  function process()
			  {
				var xh = new XMLHttpRequest();
				xh.open("GET", "/jact", true);
				xh.onreadystatechange = function()
				{
				  if (xh.readyState == 4 && xh.status == 200) 
				  {
					var res = JSON.parse(xh.responseText);
					document.getElementById('cur_time').value = res.tstr;
				  }
				}
				xh.send(null);
				setTimeout('process()',500);
			  }

			  function set_parc()
			  {
				var acorr = 0, upm = 0, ehb = 0, sndpol = 0, ledpol = 0;

				tzone   = document.getElementById('tzone').value;
				if (document.getElementById('acorr').checked) acorr = 1;
				if (document.getElementById('upm').checked) upm = 1;
				nmstart = document.getElementById('nmstart').value;
				nmstop  = document.getElementById('nmstop').value;
				if (document.getElementById('ehb').checked) ehb = 1;
				if (document.getElementById('sndpol').checked) sndpol = 1;
				if (document.getElementById('ledpol').checked) ledpol = 1;
				srtyp = document.getElementById('rtyp').value;

				url = '/set_parc?tzone='+tzone+'&acorr='+acorr+'&upm='+upm+'&nmstart='+nmstart+'&nmstop='+nmstop+'&ehb='+ehb+'&sndpol='+sndpol+'&ledpol='+ledpol+'&srtyp='+srtyp+'&sda='+sda+'&scl='+scl+'&dio='+dio+'&clk='+clk+'&dcs='+dcs+'&dwr='+dwr+'&trm='+trm+'&sqw='+sqw+'&snd='+snd+'&led='+led+'&btn='+btn+'&dht='+dht+'&ana='+ana+'&uar='+uar+'&bz2='+bz2;

				var xh = new XMLHttpRequest();
				xh.open('GET', url, true);
				xh.onreadystatechange = function()
				{
				  if (xh.readyState==4 && xh.status==200) loadValues();
				}      
				xh.send(null);
			  }

			  process();
	
			</script>
			
			<button class='w3-button w3-block w3-grey w3-section w3-padding' type='submit'>Save</button>
		</form>
  </body>
</html>
