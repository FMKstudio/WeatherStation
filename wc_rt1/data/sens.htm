<html>
  <head>
    <title>Wifi Clock Settings Sens</title>
    <meta http-equiv = 'content-type' content = 'text/html; charset = utf-8' />
    <style>
       body,td{font-family:tahoma,arial,helvetica,sans-serif;}
       table.t td.h{background-color:#C9C9C0;font-size:12px;font-weight:bold;text-align:center;}
       table.t td  {background-color:#E2E2DB;font-size:12px;text-align:center;}
    </style>
  </head>
  
  <body onload='loadValues();'>
    <table cellspacing='0' cellpadding='2' border='0' class='t' width='30%'>
      	<tr>
      	  <td align='center' class='h' width='10%'><a href='time.htm'>Time</a></td>
      	  <td align='center' class='h' width='10%'><a href='wifi.htm'>WiFi</a></td>
      	  <td align='center' class='h' width='10%'><a href='clock.htm'>Clock</a></td>
      	  <td align='center' class='h' width='10%'><a href='disp.htm'>Display</a></td>
      	  <td align='center' class='h' width='10%'><a href='sens.htm'>Sensor</a></td>
      	  <td align='center' class='h' width='10%'><a href='alarm.htm'>Alarm</a></td>
  		  <td align='center' class='h' width='10%'><a href='thermo.htm'>Thermo</a></td>
	      <td align='center' class='h' width='10%'><a href='news.htm'>News</a></td>
       	  <td align='center' class='h' width='10%'><a href='/edit'>Edit</a></td>
      	  <td align='center' class='h' width='10%'><a href='/exit'>Restart</a></td>
      	</tr>
        <tr><td colspan='10' height='20' align='center'><input type='text' id='cur_time' style='text-align:center;' readonly /></td></tr>
      </table>

    <table cellspacing='0' cellpadding='2' border='0' class='t' width='30%'>


      <tr><td colspan='2' class='h'>Опции</td></tr>
      <tr><td>city ID для GM и OWM</td><td><input type='text' size='6' id='cityID' name='cityID' style='text-align:center;' /></td></tr>
      <tr><td>OWM API Key          </td><td><input type='text' maxlength='32' size='32' id='owmk' name='owmk' style='text-align:center;' /></td></tr>
      <tr><td>Адрес внешн. сервера1</td><td><input type='text' maxlength='17' size='10' id='esaddr1' name='esaddr1' style='text-align:center;' /></td></tr>
      <tr><td>Адрес внешн. сервера2</td><td><input type='text' maxlength='17' size='10' id='esaddr2' name='esaddr2' style='text-align:center;' /></td></tr>
      <tr><td>Адрес радиоприемничка</td><td><input type='text' maxlength='17' size='10' id='rdaddr' name='rdaddr'  style='text-align:center;' /></td></tr>
      <tr><td>Адрес хоста для UDP консоли</td><td><input type='text' maxlength='17' size='10' id='udp' name='udp'  style='text-align:center;' /></td></tr>
      <tr><td>Использовать удаленную консоль</td><td>&nbsp;--------&nbsp;
    	<input type='checkbox' id='udm' name='udm' onclick='sel_ts();'/></td></tr>
      
      <tr><td width='35%'>Прогноз погоды</td>
      <td><select id='usepp' name='usepp' onclick='chk_pp();'>
      <option value = '0'>No_use</option>
      <option value = '1'>GM</option>
      <option value = '2'>OWM</option>
      </select></td></tr>

      <tr><td colspan='2' class='h'>Типы датчиков</td></tr>
      
      <tr><td width='35%'>Канал 1</td>
        <td><select id='snr1' name='snr1'  onclick='sel_ts();'>
        <option value =  '0'>No_use</option>
        <option value =  '1'>TS</option>
        <option value =  '2'>Ext srv1</option>
        <option value =  '3'>Ext srv2</option>
        <option value =  '4'>DHT21</option>
        <option value =  '5'>DS3231</option>
        <option value =  '6'>SI7021</option>
        <option value =  '7'>AM2320</option>
        <option value =  '8'>BMP180</option>
        <option value =  '9'>BMP280</option>
        <option value = '10'>BME280</option>
        <option value = '11'>Из прогноза</option>
        </select></td></tr>
      
      <tr><td width='35%'>Канал 2</td>
        <td><select id='snr2' name='snr2' onclick='sel_ts();'>
        <option value =  '0'>No_use</option>
        <option value =  '1'>TS</option>
        <option value =  '2'>Ext srv1</option>
        <option value =  '3'>Ext srv2</option>
        <option value =  '4'>DHT21</option>
        <option value =  '5'>DS3231</option>
        <option value =  '6'>SI7021</option>
        <option value =  '7'>AM2320</option>
        <option value =  '8'>BMP180</option>
        <option value =  '9'>BMP280</option>
        <option value = '10'>BME280</option>
        <option value = '11'>Из прогноза</option>
        </select></td></tr>

      <tr><td width='35%'>Канал 3</td>
        <td><select id='snr3' name='snr3' onclick='sel_ts();'>
        <option value =  '0'>No_use</option>
        <option value =  '1'>TS</option>
        <option value =  '2'>Ext srv1</option>
        <option value =  '3'>Ext srv2</option>
        <option value =  '4'>DHT21</option>
        <option value =  '5'>DS3231</option>
        <option value =  '6'>SI7021</option>
        <option value =  '7'>AM2320</option>
        <option value =  '8'>BMP180</option>
        <option value =  '9'>BMP280</option>
        <option value = '10'>BME280</option>
        <option value = '11'>Из прогноза</option>
        </select></td></tr>
      
      <tr><td width='35%'>Давления</td>
        <td><select id='snrp' name='snrp' onclick='sel_ts();'>
        <option value =  '0'>No_use</option>
        <option value =  '1'>TS</option>
        <option value =  '2'>Ext srv1</option>
        <option value =  '3'>Ext srv2</option>
        <option value =  '8'>BMP180</option>
        <option value =  '9'>BMP280</option>
        <option value = '10'>BME280</option>
        <option value = '11'>Из прогноза</option>
       </select></td></tr>

      <tr><td>Период опроса (мин)</td><td><input type='text' size='2' id='period' name='period' style='text-align:center;'/></td></tr>

      <tr><td colspan='4' class='h'>Текущие показания</td></tr>

        <tr><td width='20%'>Номер Канала</td><td>&nbsp;1--------------2-------------3&nbsp;</td></tr>
        <tr><td width='20%'>Название</td><td>
        <input type='text' maxlength='8' size='3' id='name_ch1' name='name_ch1' style='text-align:center;' />
    		<input type='text' maxlength='8' size='3' id='name_ch2' name='name_ch2' style='text-align:center;' />
        <input type='text' maxlength='8' size='3' id='name_ch3' name='name_ch3' style='text-align:center;' /></td></tr>
        <tr><td width='20%'>Температура</td><td>
        <input type='text' maxlength='3' size='3' id='cur_t1' name='cur_t1' style='text-align:center;' readonly />
        <input type='text' maxlength='3' size='3' id='cur_t2' name='cur_t2' style='text-align:center;' readonly />
        <input type='text' maxlength='3' size='3' id='cur_t3' name='cur_t3' style='text-align:center;' readonly /></td></tr>
        <tr><td width='20%'>Влажность</td><td>
        <input type='text' maxlength='3' size='3' id='cur_h1' name='cur_h1' style='text-align:center;' readonly />
        <input type='text' maxlength='3' size='3' id='cur_h2' name='cur_h2' style='text-align:center;' readonly />
        <input type='text' maxlength='3' size='3' id='cur_h3' name='cur_h3' style='text-align:center;' readonly /></td></tr>
        <tr><td>Давление</td><td>&nbsp;--------------------------&nbsp;
    		<input type='text' maxlength='3' size='3' id='cur_p'  name='cur_p'  style='text-align:center;' readonly /></td></tr>

      <tr><td colspan='4' class='h'>Параметры аккаунта ТS:</td></tr>

        <tr><td>Channel ID</td><td><input type='text' size='6' id='tschan' name='tschan' style='text-align:center;' /></td></tr>
        <tr><td>API key R</td><td><input type='text' size='17' id='tsapir' name='tsapir' style='text-align:center;' /></td></tr>
        <tr><td>API key W</td><td><input type='text' size='17' id='tsapiw' name='tsapiw' style='text-align:center;' /></td></tr>
    
      <tr><td colspan='4' class='h'>Отправка показаний на ТS с датчиков:</td></tr>

        <tr><td width='20%'>Номер Канала</td><td>&nbsp;1----2----3&nbsp;</td></tr>
        <tr><td width='20%'>Температура</td><td>
		    <input type='checkbox' id='utst1' name='utst1' onclick='sel_ts();'/>
	    	<input type='checkbox' id='utst2' name='utst2' onclick='sel_ts();'/>
	    	<input type='checkbox' id='utst3' name='utst3' onclick='sel_ts();'/></td></tr>
        <tr><td width='20%'>Влажность</td><td>
	    	<input type='checkbox' id='utsh1' name='utsh1' onclick='sel_ts();'/>
	    	<input type='checkbox' id='utsh2' name='utsh2' onclick='sel_ts();'/>
	    	<input type='checkbox' id='utsh3' name='utsh3' onclick='sel_ts();'/></td></tr>
        <tr><td>Давление</td><td>&nbsp;--------&nbsp;
	    	<input type='checkbox' id='utsp' name='utsp' onclick='sel_ts();'/></td></tr>
 
  
      <tr><td colspan='4' class='h'><input type='submit' value='Записать' onclick='set_pars1();' /></td></tr>
  
    </table>
  
    <script>

      function loadValues()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jsens", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 && xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('cityID').value   = res.cyid;
            document.getElementById('owmk').value     = res.owmk;
            document.getElementById('esaddr1').value  = res.srve1;
            document.getElementById('esaddr2').value  = res.srve2;
            document.getElementById('rdaddr').value   = res.srvr;
            document.getElementById('udp').value      = res.udp;
            document.getElementById('udm').checked    = res.udm;
            document.getElementById('usepp').value    = res.prgp;
            document.getElementById('snr1').value     = res.s1;
            document.getElementById('snr2').value     = res.s2;
            document.getElementById('snr3').value     = res.s3;
            document.getElementById('snrp').value     = res.sp;
            document.getElementById('name_ch1').value = res.nc1;
            document.getElementById('name_ch2').value = res.nc2;
            document.getElementById('name_ch3').value = res.nc3;
            document.getElementById('period').value   = res.peri;

            chk_pp();
            
    	    }
        }
        xh.send(null);
        loadTs();
      }
      
      function loadTs()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jts", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 &&  xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('tschan').value = res.tsid;
            document.getElementById('tsapir').value = res.tsar;
            document.getElementById('tsapiw').value = res.tsaw;
            document.getElementById('utst1').checked = res.tsst1;
            document.getElementById('utst2').checked = res.tsst2;
            document.getElementById('utst3').checked = res.tsst3;
            document.getElementById('utsh1').checked = res.tssh1;
            document.getElementById('utsh2').checked = res.tssh2;
            document.getElementById('utsh3').checked = res.tssh3;
            document.getElementById('utsp').checked  = res.tssp;
          
            sel_ts();
          }   	  
        }
        xh.send(null);
        loadSnr();
      }
      
      function loadSnr()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jsnr", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 &&  xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('cur_t1').value = res.t1;
            document.getElementById('cur_t2').value = res.t2;
            document.getElementById('cur_t3').value = res.t3;
            document.getElementById('cur_h1').value = res.h1;
            document.getElementById('cur_h2').value = res.h2;
            document.getElementById('cur_h3').value = res.h3;
            document.getElementById('cur_p' ).value = res.pres;
    	    }
        }
        xh.send(null);
      }
    

      function showHide(element_id, visible) 
      {
      //Если элемент с id-шником element_id существует
        if (document.getElementById(element_id)) 
        { 
          //Записываем ссылку на элемент в переменную obj
          var obj = document.getElementById(element_id); 
          if (visible) obj.style.display = "inline-block"; //Показываем элемент
          else obj.style.display = "none"; //Скрываем элемент
        }
        //Если элемент с id-шником element_id не найден, то выводим сообщение
        else alert("Элемент с id: " + element_id + " не найден!"); 
      }   

      function process()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jactt", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 && xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('cur_time').value = res.tstr;
          }
        }
        xh.send(null);
        
		var xh1 = new XMLHttpRequest();
        xh1.open("GET", "/jsnr", true);
        xh1.onreadystatechange = function()
        {
          if (xh1.readyState == 4 && xh1.status == 200) 
          {
            var res1 = JSON.parse(xh1.responseText);
            document.getElementById('cur_t1').value = res1.t1;
            document.getElementById('cur_t2').value = res1.t2;
            document.getElementById('cur_t3').value = res1.t3;
            document.getElementById('cur_h1').value = res1.h1;
            document.getElementById('cur_h2').value = res1.h2;
            document.getElementById('cur_h3').value = res1.h3;
            document.getElementById('cur_p' ).value = res1.pres;
          }
        }
        xh1.send(null);

        setTimeout('process()',500);
      }

      
      function set_pars1()
      {
   
        var udm_t = 0;     
        var cid_t  = document.getElementById('cityID').value;
        var owmk_t = document.getElementById('owmk').value;
        var esa1_t = document.getElementById('esaddr1').value;
        var esa2_t = document.getElementById('esaddr2').value;
        var rda_t  = document.getElementById('rdaddr').value;
        var udp_t  = document.getElementById('udp').value;
        if (document.getElementById('udm').checked) udm_t = 1;
        var upp_t  = document.getElementById('usepp').value;
 
        url='/set_pars1?cid='+cid_t
					 + '&owmk='+owmk_t
					 + '&esa1='+esa1_t
					 + '&esa2='+esa2_t
					 + '&rda=' +rda_t
					 + '&udp=' +udp_t
					 + '&udm=' +udm_t
					 + '&upp=' +upp_t;

      var xh = new XMLHttpRequest();
          xh.open('GET', url, true);
  		    xh.onreadystatechange = function()
  		    {
  		      if (xh.readyState==4 && xh.status==200) set_pars2();
  		    }
          xh.send(null);
      }
      
      function set_pars2()
      {
        snr1_t   = document.getElementById('snr1').value;
        snr2_t   = document.getElementById('snr2').value;
        snr3_t   = document.getElementById('snr3').value;
        snrp_t   = document.getElementById('snrp').value;
 	    period_t   = document.getElementById('period').value;
         nc1_t   = document.getElementById('name_ch1').value;
         nc2_t   = document.getElementById('name_ch2').value;
         nc3_t   = document.getElementById('name_ch3').value;
      
        url='/set_pars2?snr1='    + snr1_t
					 + '&snr2='   + snr2_t
					 + '&snr3='   + snr3_t
					 + '&snrp='   + snrp_t
					 + '&period=' + period_t
					 + '&nc1='    + nc1_t
					 + '&nc2='    + nc2_t
					 + '&nc3='    + nc3_t;

      var xh = new XMLHttpRequest();
          xh.open('GET', url, true);
  		    xh.onreadystatechange = function()
  		    {
  		      if (xh.readyState==4 && xh.status==200) set_pars3();
  		    }
          xh.send(null);
      }
      
      function set_pars3()
      {
        var utst1_t = 0, utst2_t = 0, utst3_t = 0, utsh1_t = 0, utsh2_t = 0, utsh3_t = 0, utsp_t = 0;

        tschan_t = document.getElementById('tschan').value;
        tsapir_t = document.getElementById('tsapir').value;
        tsapiw_t = document.getElementById('tsapiw').value;
        if (document.getElementById('utst1').checked) utst1_t = 1;
        if (document.getElementById('utst2').checked) utst2_t = 1;
        if (document.getElementById('utst3').checked) utst3_t = 1;
        if (document.getElementById('utsh1').checked) utsh1_t = 1;
        if (document.getElementById('utsh2').checked) utsh2_t = 1;
        if (document.getElementById('utsh3').checked) utsh3_t = 1;
        if (document.getElementById('utsp').checked)   utsp_t = 1;

        url='/set_pars3?tschan='+tschan_t
					 +'&tsapir='+tsapir_t
					 +'&tsapiw='+tsapiw_t
					 +'&utst1=' +utst1_t
					 +'&utst2=' +utst2_t
					 +'&utst3=' +utst3_t
					 +'&utsh1=' +utsh1_t
					 +'&utsh2=' +utsh2_t
					 +'&utsh3=' +utsh3_t
					 +'&utsp='	+ utsp_t;
  
      var xh = new XMLHttpRequest();
          xh.open('GET', url, true);
  		    xh.onreadystatechange = function()
          {
            if (xh.readyState==4 && xh.status==200) loadValues();
          }      
          xh.send(null);
      }

      function sel_ts()
      {
        var utst1_t = 0, utst2_t = 0, utst3_t = 0, utsh1_t = 0, utsh2_t = 0, utsh3_t = 0, utsp_t = 0, udm_t = 0;

        if (document.getElementById('utst1').checked) utst1_t = 1;
        if (document.getElementById('utst2').checked) utst2_t = 1;
        if (document.getElementById('utst3').checked) utst3_t = 1;
        if (document.getElementById('utsh1').checked) utsh1_t = 1;
        if (document.getElementById('utsh2').checked) utsh2_t = 1;
        if (document.getElementById('utsh3').checked) utsh3_t = 1;
        if (document.getElementById('utsp').checked)  utsp_t = 1;
         
         if (utst1_t == 1 || utst2_t == 1 || utst3_t == 1 || utsh1_t == 1 || utsh2_t == 1 || utsh3_t == 1 || utsp_t == 1) showHide('tsapiw',  true);
         else showHide('tsapiw',  false);

        snr1_t   = document.getElementById('snr1').value;
        snr2_t   = document.getElementById('snr2').value;
        snr3_t   = document.getElementById('snr3').value;
        snrp_t   = document.getElementById('snrp').value;

/////////////////////////////////// For TS
         if (snr1_t == 1 || snr2_t == 1 || snr3_t == 1 || snrp_t == 1) showHide('tsapir',  true);
         else showHide('tsapir',  false);

         if (snr1_t == 1 || snr2_t == 1 || snr3_t == 1 || snrp_t == 1 || utst1_t == 1 || utst2_t == 1 || utst3_t == 1 || utsh1_t == 1 || utsh2_t == 1 || utsh3_t == 1 || utsp_t == 1) showHide('tschan',  true);
         else showHide('tschan',  false);

/////////////////////////////////// For ES
         if (snr1_t == 2 || snr2_t == 2 || snr3_t == 2 || snrp_t == 2) showHide('esaddr1',  true);
         else showHide('esaddr1',  false);

         if (snr1_t == 3 || snr2_t == 3 || snr3_t == 3 || snrp_t == 3) showHide('esaddr2',  true);
         else showHide('esaddr2',  false);


/////////////////////////////////// For UDP
         if (document.getElementById('udm').checked)  udm_t = 1;
         if (udm_t == 1) showHide('udp',  true);
         else showHide('udp',  false);
 

/////////////////////////////////// For NotUse
         if (snr1_t > 0) 
         {
           showHide('cur_t1',  true);
           showHide('cur_h1',  true);
		       showHide('name_ch1',true);
         }
         else 
         {
           showHide('cur_t1',  false);
           showHide('cur_h1',  false);
		       showHide('name_ch1',false);
         }

         if (snr2_t > 0) 
         {
           showHide('cur_t2',  true);
           showHide('cur_h2',  true);
		       showHide('name_ch2',true);
         }
         else 
         {
           showHide('cur_t2',  false);
           showHide('cur_h2',  false);
		       showHide('name_ch2',false);
         }

         if (snr3_t > 0) 
         {
           showHide('cur_t3',  true);
           showHide('cur_h3',  true);
		       showHide('name_ch3',true);
         }
         else 
         {
           showHide('cur_t3',  false);
           showHide('cur_h3',  false);
 		       showHide('name_ch3',false);
        }

         if (snrp_t > 0) 
         {
           showHide('cur_p',  true);
           showHide('cur_p',  true);
         }
         else 
         {
           showHide('cur_p',  false);
           showHide('cur_p',  false);
         }
      }
      
      function chk_pp()
      {
         usepp_t  = document.getElementById('usepp').value;
         
         if (usepp_t > 0 ) showHide('cityID',  true);
         else showHide('cityID',  false);

         if (usepp_t == 2 ) showHide('owmk',  true);
         else showHide('owmk',  false);
      }
      
      process();
      
    </script>
  </body>
</html>
