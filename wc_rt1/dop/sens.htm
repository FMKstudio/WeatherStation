<html>
  <head>
    <title>Wifi Clock Settings</title>
    <meta http-equiv = 'content-type' content = 'text/html; charset = utf-8' />
    <style>
       body,td{font-family:tahoma,arial,helvetica,sans-serif;}
       table.t td.h{background-color:#C9C9C0;font-size:12px;font-weight:bold;text-align:center;}
       table.t td  {background-color:#E2E2DB;font-size:12px;}
    </style>
  </head>
  
  <body onload='loadValues();'>
    <table cellspacing='0' cellpadding='2' border='0' class='t' width='30%'>
  	<tr>
  	  <td align='center' class='h' width='5%'><a href='time.htm'>Time</a></td>
  	  <td align='center' class='h' width='5%'><a href='wifi.htm'>WiFi</a></td>
  	  <td align='center' class='h' width='5%'><a href='clock.htm'>Clock</a></td>
  	  <td align='center' class='h' width='5%'><a href='disp.htm'>Display</a></td>
  	  <td align='center' class='h' width='5%'><a href='sens.htm'>Sensor</a></td>
  	  <td align='center' class='h' width='5%'><a href='alarm.htm'>Alarm</a></td>
  	  <td align='center' class='h' width='5%'><a href='/edit'>Edit</a></td>
  	  <td align='center' class='h' width='5%'><a href='/exit'>Exit</a></td>
  	</tr>

    <tr><td colspan='8' height='20' align='center'><input type='text' id='cur_time' style='text-align:center;' readonly /></td></tr>
    </table>
  
    <table cellspacing='0' cellpadding='2' border='0' class='t' width='30%'>
      <tr><td colspan='2' class='h'>Опции</td></tr>
      <tr><td>ИД города для GM</td><td><input type='text' size='16' style="display:none" id='ppaddr' name='ppaddr'/></td></tr>
      <tr><td>Адрес внешн. сервера</td><td><input type='text' size='16' id='esaddr' name='esaddr'/></td></tr>
      <tr><td>Период опроса (мин)</td><td><input type='text' size='2' id='period' name='period' style='text-align:center;'/></td></tr>
      <tr><td>Сервер погоды      </td><td><input type='checkbox' onclick="change('ppaddr')" id='ues' name='ues'/></td></tr>
      <tr><td>Прогноз погоды     </td><td><input type='checkbox' id='upp' name='upp'/></td></tr>
      
      <tr><td colspan='4' class='h'>Типы датчиков</td></tr>
      
      <tr><td width='35%'>Внешний</td>
        <td><select id='esnr' name='esnr'>
        <option value = '0'>No_use</option>
        <option value = '1'>TS</option>
        <option value = '2'>Ext srv</option>
        <option value = '3'>DHT21</option>
        <option value = '4'>DS3231</option>
        <option value = '5'>SI7021</option>
        <option value = '6'>AM2320</option>
        <option value = '7'>BMP180</option>
        <option value = '8'>BMP280</option>
        <option value = '9'>BME280</option>
        </select></td></tr>
      
      <tr><td width='35%'>Внутренний</td>
        <td><select id='isnr' name='isnr'>
        <option value = '0'>No_use</option>
        <option value = '1'>TS</option>
        <option value = '2'>Ext srv</option>
        <option value = '3'>DHT21</option>
        <option value = '4'>DS3231</option>
        <option value = '5'>SI7021</option>
        <option value = '6'>AM2320</option>
        <option value = '7'>BMP180</option>
        <option value = '8'>BMP280</option>
        <option value = '9'>BME280</option>
        </select></td></tr>
      
      <tr><td width='35%'>Давления</td>
        <td><select id='psnr' name='psnr'>
        <option value = '0'>No_use</option>
        <option value = '1'>TS</option>
        <option value = '2'>Ext srv</option>
        <option value = '7'>BMP180</option>
        <option value = '8'>BMP280</option>
        <option value = '9'>BME280</option>
       </select></td></tr>

      <tr><td colspan='2' class='h'>Текущие показания</td></tr>

        <tr><td width='20%'>Температура</td><td>
        &nbsp;снаружи&nbsp;<input type='text' maxlength='2' size='1' id='cur_t2' name='cur_t2' style='text-align:center;' readonly />&nbsp;внутри&nbsp;
        <input type='text' maxlength='2' size='1' id='cur_t1' name='cur_t1'  style='text-align:center;'/></td></tr>
        <tr><td width='20%'>Влажность</td><td>
        &nbsp;снаружи&nbsp;<input type='text' maxlength='2' size='1' id='cur_h2' name='cur_h2' style='text-align:center;' readonly />&nbsp;внутри&nbsp;
        <input type='text' maxlength='2' size='1' id='cur_h1' name='cur_h1'  style='text-align:center;'/></td></tr>
        <tr><td>Давление</td><td>&nbsp;---------------------&nbsp;<input type='text' size='3' id='cur_p' name='cur_p'  style='text-align:center;' readonly /></td></tr>
    
      <tr><td colspan='4' class='h'>Отправка показаний на ТS с датчиков:</td></tr>

        <tr><td>Внутреннего</td><td><input type='checkbox' id='utsi' name='utsi'/></td></tr>
        <tr><td>Внешнего</td><td><input type='checkbox' id='utse' name='utse'/></td></tr>
        <tr><td>Давления</td><td><input type='checkbox' id='utsp' name='utsp'/></td></tr>
        <tr><td colspan='4' class='h'>Параметры аккаунта ТS:</td></tr>
        <tr><td>Channel ID</td><td><input type='text' size='6' id='tschan' name='tschan'/></td></tr>
        <tr><td>API key R</td><td><input type='text' size='16' id='tsapir' name='tsapir'/></td></tr>
        <tr><td>API key W</td><td><input type='text' size='16' id='tsapiw' name='tsapiw'/></td></tr>
    
      <tr><td colspan='4' class='h'><input type='submit' value='Записать' onclick='set_pars();' /></td></tr>
  
    </table>
  
    <script>

      function change(idName) 
      {
	if(document.getElementById(idName).style.display=='none') 
        {
	   document.getElementById(idName).style.display = '';
	}
        else 
        {
	   document.getElementById(idName).style.display = 'none';
	}
        return false;
      }     
      
      function loadValues()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jsens", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 && xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('ppaddr').value = res.cyid;
            document.getElementById('esaddr').value = res.srve;
            document.getElementById('period').value = res.peri;
            document.getElementById('esnr').value   = res.exts;
            document.getElementById('isnr').value   = res.ints;
            document.getElementById('psnr').value   = res.prss;
            document.getElementById('upp').checked  = res.prgp;
            document.getElementById('ues').checked  = res.srvp;
    	    }
        }
        xh.send(null);
        loadTs();
      }
      
      function loadTs()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jts", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 &&  xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('utsi').checked = res.tssi;
            document.getElementById('utse').checked = res.tsse;
            document.getElementById('utsp').checked = res.tssp;
            document.getElementById('tschan').value = res.tsid;
            document.getElementById('tsapir').value = res.tsar;
            document.getElementById('tsapiw').value = res.tsaw;
          }   	  
        }
        xh.send(null);
        loadSnr();
      }
      
      function loadSnr()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jsnr", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 &&  xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('cur_t1').value = res.tint;
            document.getElementById('cur_t2').value = res.text;
            document.getElementById('cur_h1').value = res.hint;
            document.getElementById('cur_h2').value = res.hext;
            document.getElementById('cur_p' ).value = res.pres;
    	    }
        }
        xh.send(null);
      }
    

      function process()
      {
        var xh = new XMLHttpRequest();
        xh.open("GET", "/jtime", true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState == 4 && xh.status == 200) 
          {
            var res = JSON.parse(xh.responseText);
            document.getElementById('cur_time').value = res.tstr;
          }
        }
        xh.send(null);
        loadSnr();
        setTimeout('process()',500);
      }

      
      function set_pars()
      {
        var utsi_t = 0, utse_t = 0, utsp_t = 0, ues_t = 0, upp_t = 0;

        if (document.getElementById('utsi').checked) utsi_t = 1;
        if (document.getElementById('utse').checked) utse_t = 1;
        if (document.getElementById('utsp').checked) utsp_t = 1;
        tschan_t = document.getElementById('tschan').value;
        tsapir_t = document.getElementById('tsapir').value;
        tsapiw_t = document.getElementById('tsapiw').value;
        ppaddr_t = document.getElementById('ppaddr').value;
        esaddr_t = document.getElementById('esaddr').value;
        period_t = document.getElementById('period').value;
        if (document.getElementById('ues').checked) ues_t = 1;
        if (document.getElementById('upp').checked) upp_t = 1;
        esnr_t   = document.getElementById('esnr').value;
        isnr_t   = document.getElementById('isnr').value;
        psnr_t   = document.getElementById('psnr').value;

/*        url='/set_pars?utsi_t='+utsi_t+'&utse_t='+utse_t+'&utsp_t='+utsp_t+'&tschan_t='+tschan_t+'&tsapir_t='+tsapir_t+'&tsapiw_t='+tsapiw_t+'&ppaddr_t='+ppaddr_t+'&esaddr_t='+esaddr_t+'&period_t='+period_t+'&ues_t='+ues_t+'&upp_t='+upp_t+'&esnr_t='+esnr_t+'&isnr_t='+isnr_t+'&psnr_t='+psnr_t;

        var xh = new XMLHttpRequest();
        xh.open('GET', url, true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState==4 && xh.status==200) loadValues();
        }      
        xh.send(null);
      }
  */
var people =  { "programmers": [    { "firstName": "Brett", "lastName":"McLaughlin",
"email": "brett@newInstance.com" },    { "firstName": "Jason", "lastName":"Hunter",
"email": "jason@servlets.com" },    { "firstName": "Elliotte", "lastName":"Harold",
"email": "elharo@macfaq.com" }   ],  "authors": [    { "firstName": "Isaac", 
"lastName": "Asimov", "genre": "science fiction" },    { "firstName": "Tad", 
"lastName": "Williams", "genre": "fantasy" },    { "firstName": "Frank", 
"lastName": "Peretti", "genre": "christian fiction" }   ],  "musicians": [    
{ "firstName": "Eric", "lastName": "Clapton", "instrument": "guitar" },   
{ "firstName": "Sergei", "lastName": "Rachmaninoff", "instrument": "piano" }   ]  }

var url = "organizePeople.php?people=" + escape(people.JSONString());
request.open("GET", url, true);
request.onreadystatechange = updatePage;
request.send(null);
 }   
      process();
      
    </script>
  </body>
</html>
