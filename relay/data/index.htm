<html>
  <head>
    <title>Wifi Clock Settings Wifi</title>
    <meta http-equiv = 'content-type' content = 'text/html; charset = utf-8' />
    <style>
       body,td{font-family:tahoma,arial,helvetica,sans-serif;}
       table.t td.h{background-color:#C9C9C0;font-size:12px;font-weight:bold;text-align:center;}
       table.t td  {background-color:#E2E2DB;font-size:12px;text-align:center;}
    </style>
  </head>
  
  <body onload='loadValues();'>

    <table border="1" align="center" cellpadding="4" cellspacing="0" class='t' width='30%'>
    
      <tr>
        <td colspan='3' align="center" class='h'>Точка доступа</td>
      </tr>
      <tr>
        <td>SSID</td><td colspan='2' align="center"><input type='text' size='10' id='aps' name='aps'   style='text-align:center;' /></td>
      </tr>
      <tr>
        <td>Password</td><td colspan='2' align="center"><input type='password' size='10' id='app' name='app'  style='text-align:center;' /></td>
      </tr>
      <tr>
        <td colspan='3' align="center" class='h'>Клиент</td>
      </tr>
      <tr>
        <td>SSID    </td><td colspan='2' align="center"><input type='text'     size='10' id='stas' name='stas' style='text-align:center;' /></td>
      </tr>
      <tr>
        <td>Password</td><td colspan='2' align="center"><input type='password' size='10' id='stap' name='stap' style='text-align:center;' /></td>
      </tr>
      <tr>
        <td class='h'>Выходы</td>
        <td class='h'>1</td>
        <td class='h'>2</td>
      </tr>
      <tr>
        <td>GPIO</td>
        <td><input type='text' size='3' id='pin1' name='pin1' style='text-align:center;'/></td>
        <td><input type='text' size='3' id='pin2' name='pin2' style='text-align:center;'/></td>
      </tr>
      <tr>
        <td>ON Code</td>
        <td><input type='text' size='2' id='on1_code' name='on1_code' style='text-align:center;'/></td>
        <td><input type='text' size='2' id='on2_code' name='on2_code' style='text-align:center;'/></td>
      </tr>
      <tr>
        <td colspan='1'>OFF Code</td>
        <td><input type='text' size='2' id='off1_code' name='off1_code' style='text-align:center;'/></td>
        <td><input type='text' size='2' id='off2_code' name='off2_code' style='text-align:center;'/></td>
      </tr>
      <tr>
        <td>ON/OFF</td>
        <td><input type='button' value='Off'    onclick='Q1_On_Off();' id='on1'    name='on1'   style='text-align:center'/></td>
        <td><input type='button' value='Off'    onclick='Q2_On_Off();' id='on2'    name='on2'   style='text-align:center'/></td>
      </tr>
      <tr>
        <td>AUTO/MAN</td>
        <td><input type='button' value='Manual' onclick='Q1_Auto();'   id='auto1'  name='auto1' style='text-align:center'/></td>
        <td><input type='button' value='Manual' onclick='Q2_Auto();'   id='auto2'  name='auto2' style='text-align:center'/></td>
      </tr>
      <tr>
        <td colspan='3' align="center" class='h'>Освещенность</td>
      </tr>
      <tr>
        <td>Верхний предел </td><td><input type='range' min=0 max=255 id='lim_h' name='lim_h'/></td>
        <td><output id='rlimh' name='rliml'></output></td>
      </tr>
      <tr>
        <td> Нижний предел </td><td><input type='range' min=0 max=255 id='lim_l' name='lim_l'/></td>
        <td><output id='rliml' name='rliml'></output></td>
      </tr>
      <tr>
        <td>Текущее значение </td>
        <td></td>
        <td><output id='cur_br' name='cur_br'></output></td>
      </tr>
      <tr>
        <td colspan='3' align="center" class='h'><input type='submit' value='Записать' onclick='set_wifi();' /></td>
      </tr>
      <tr>
        <td colspan='3' align="center" class='h'><a href='update'>Обновление прошивки</a></td>
      </tr>
    </table>
 
    <script>
   
      function loadValues()
      {
        var xh1 = new XMLHttpRequest();
        xh1.open("GET", "/jwifi", true);
        xh1.onreadystatechange =  function()
        {
          if (xh1.readyState == 4 && xh1.status == 200) 
          {
            var res = JSON.parse(xh1.responseText);
            document.getElementById('aps' ).value = res.apid;
            document.getElementById('app' ).value = res.appas;
            document.getElementById('stas').value = res.staid;
            document.getElementById('stap').value = res.stapas;
            document.getElementById('pin1').value = res.pin1_name;
            document.getElementById('pin2').value = res.pin2_name;
            document.getElementById('on1_code').value = res.on1_code;
            document.getElementById('off1_code').value = res.off1_code;
            document.getElementById('on2_code').value = res.on2_code;
            document.getElementById('off2_code').value = res.off2_code;
            document.getElementById('lim_l').value = res.lim_l;
            document.getElementById('lim_h').value = res.lim_h;
          }
        }
        xh1.send(null);
      }

      function Q1_On_Off()
      {
        var xh = new XMLHttpRequest();
        xh.open('GET', '/q1_set', true);
        xh.send(null);
      }

      function Q1_Auto()
      {
        var xh = new XMLHttpRequest();
        xh.open('GET', '/q1_auto', true);
        xh.send(null);
      }

      function Q2_On_Off()
      {
        var xh = new XMLHttpRequest();
        xh.open('GET', '/q2_set', true);
        xh.send(null);
      }

      function Q2_Auto()
      {
        var xh = new XMLHttpRequest();
        xh.open('GET', '/q2_auto', true);
        xh.send(null);
      }

	    function set_wifi()
      {
        var as  = document.getElementById('aps').value;
      	var ap  = document.getElementById('app').value;
      	var ss  = document.getElementById('stas').value;
      	var sp  = document.getElementById('stap').value;

        var p1  = document.getElementById('pin1').value;
        var p2  = document.getElementById('pin2').value;
        var on1 = document.getElementById('on1_code').value;
        var of1 = document.getElementById('off1_code').value;
        var on2 = document.getElementById('on2_code').value;
        var of2 = document.getElementById('off2_code').value;
        var ll  = document.getElementById('lim_l').value;
        var lh  = document.getElementById('lim_h').value;

      	url='/set_wifi?as='+as+'&ap='+ap+'&ss='+ss+'&sp='+sp+'&p1='+p1
      	+'&p2='+p2+'&on1='+on1+'&of1='+of1+'&on2='+on2+'&of2='+of2+'&ll='+ll+'&lh='+lh;

        var xh = new XMLHttpRequest();
        xh.open('GET', url, true);
        xh.onreadystatechange = function()
        {
          if (xh.readyState==4 && xh.status==200) 
          {
           loadValues();
          }
        }
        xh.send(null);
      }
      
      function process()
      {
        var xh1 = new XMLHttpRequest();
        xh1.open("GET", "/jwifi", true);
        xh1.onreadystatechange = function()
        {
          if (xh1.readyState == 4 && xh1.status == 200) 
          {
            var res = JSON.parse(xh1.responseText);
            document.getElementById('cur_br').value = res.ana_code;
            
            if ( res.out1_state)  document.getElementById(  'on1').value = 'On';
            if (!res.out1_state)  document.getElementById(  'on1').value = 'Off';
            if ( res.out1_auto)   document.getElementById('auto1').value = 'Auto';
            if (!res.out1_auto)   document.getElementById('auto1').value = 'Manual';
        
            if ( res.out2_state)  document.getElementById(  'on2').value = 'On';
            if (!res.out2_state)  document.getElementById(  'on2').value = 'Off';
            if ( res.out2_auto)   document.getElementById('auto2').value = 'Auto';
            if (!res.out2_auto)   document.getElementById('auto2').value = 'Manual';

            var d1 = document.getElementById('lim_h').value;
            document.getElementById('rlimh').value = d1;

            d1 = document.getElementById('lim_l').value;
            document.getElementById('rliml').value = d1;
          }
        }

        xh1.send(null);
        setTimeout('process()',200);
      }

      process();
        
    </script>
  </body>
</html>
